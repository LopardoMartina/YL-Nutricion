{% extends 'base.html' %}

{% load static %}
{% load django_browser_reload %}

{% block title %}Configurar Disponibilidad - Nutrición YL{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/styles_turnos_disp.css' %}">
{% endblock %}

{% block content %}
<div class="disponibilidad-container">
    <h1>Configurar Disponibilidad Horaria</h1>
    
    <div class="form-agregar">
        <h2>Agregar Nueva Disponibilidad</h2>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="action" value="agregar">
            
            <div class="form-row">
                <div class="form-group">
                    <label>Día de la semana</label>
                    <select name="dia_semana" class="form-control" required>
                        {% for codigo, nombre in dias_semana %}
                        <option value="{{ codigo }}">{{ nombre }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Hora inicio</label>
                    <input type="time" name="hora_inicio" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label>Hora fin</label>
                    <input type="time" name="hora_fin" class="form-control" required>
                </div>
            </div>
            
            <button type="submit" class="btn btn-primary">Agregar Disponibilidad</button>
        </form>
    </div>
    
    <div class="disponibilidad-list">
        <h2 style="padding: 1rem; border-bottom: 2px solid #dee2e6; margin: 0;">Disponibilidades Actuales</h2>
        
        {% for disp in disponibilidades %}
        <div class="disponibilidad-item">
            <div class="disponibilidad-info">
                <div class="dia-nombre">{{ disp.get_dia_semana_display }}</div>
                <div class="horario">{{ disp.hora_inicio|time:"H:i" }} - {{ disp.hora_fin|time:"H:i" }}</div>
            </div>
            
            <div class="disponibilidad-actions">
                <span class="estado-badge {% if disp.activo %}estado-activo{% else %}estado-inactivo{% endif %}">
                    {% if disp.activo %}Activo{% else %}Inactivo{% endif %}
                </span>
                
                <form method="post" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="toggle">
                    <input type="hidden" name="disp_id" value="{{ disp.id }}">
                    <button type="submit" class="btn btn-sm btn-secondary">
                        {% if disp.activo %}Desactivar{% else %}Activar{% endif %}
                    </button>
                </form>
                
                <form method="post" style="display: inline;" onsubmit="return confirm('¿Eliminar esta disponibilidad?');">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="eliminar">
                    <input type="hidden" name="disp_id" value="{{ disp.id }}">
                    <button type="submit" class="btn btn-sm btn-danger">Eliminar</button>
                </form>
            </div>
        </div>
        {% empty %}
        <div style="padding: 2rem; text-align: center; color: #666;">
            No hay disponibilidades configuradas. Agrega tu primera disponibilidad arriba.
        </div>
        {% endfor %}
    </div>
    
    <a href="{% url 'turnos:calendario' %}" class="btn btn-secondary">Volver al Calendario</a>
</div>
{% endblock %}