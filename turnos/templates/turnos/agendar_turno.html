{% extends 'base.html' %}

{% load static %}
{% load django_browser_reload %}

{% block title %}Agendar Turno - Nutrición YL{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/styles_turnos_agendar.css' %}">
{% endblock %}

{% block content %}
<div class="container">
    <div class="header">
        <h1>Calendario de Turnos</h1>
    </div>

    <div class="calendar-nav">
        <button class="nav-btn" id="prevMonth">‹ Anterior</button>
        <div class="month-year" id="monthYear"></div>
        <button class="nav-btn" id="nextMonth">Siguiente›</button>
    </div>

    <div class="calendar">
        <div class="calendar-grid" id="calendar">
            <!-- Calendar will be generated here -->
        </div>
    </div>

    <div class="time-slots" id="timeSlots">
        <h3 id="selectedDate">Selecciona un horario</h3>
        <div class="slots-grid" id="slotsGrid">
            <!-- Time slots will be generated here -->
        </div>
        
        <div class="booking-form" id="bookingForm">
            <form method="post" id="turnoForm">
                {% csrf_token %}
                <input type="hidden" name="fecha" id="inputFecha">
                <input type="hidden" name="hora" id="inputHora">
                
                <div class="form-group">
                    <label for="motivo">Motivo de la consulta (opcional):</label>
                    <input type="text" id="motivo" name="motivo" placeholder="Ej: Primera consulta, seguimiento...">
                </div>
                
                <div class="btn-group">
                    <button type="button" class="btn btn-secondary" id="cancelBooking">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Confirmar Turno</button>
                </div>
            </form>
        </div>
    </div>

    <div class="appointments">
        <h3>Mis Turnos Próximos</h3>
        <div id="appointmentsList">
            {% if turnos_futuros %}
                {% for turno in turnos_futuros %}
                <div class="appointment-item">
                    <div class="appointment-info">
                        <div class="appointment-date">
                            {{ turno.fecha|date:"l, d \\d\\e F \\d\\e Y" }} - {{ turno.hora }}
                        </div>
                        <div class="appointment-name">{{ turno.motivo|default:"Sin motivo especificado" }}</div>
                    </div>
                    <form method="post" action="{% url 'turnos:cancelar' turno.id %}" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn-cancel" onclick="return confirm('¿Estás seguro de cancelar este turno?')">
                            Cancelar
                        </button>
                    </form>
                </div>
                {% endfor %}
            {% else %}
                <p style="color: #666; font-style: italic;">No tienes turnos reservados</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}


{% block extra_js %}
    <script src="{% static 'js/agendar_turno.js' %}"></script>
{% endblock %}

